import { useState, useRef, useEffect } from "react";

export function ScrollingTitle({ title }: { title: string }) {
  const [isOverflowing, setIsOverflowing] = useState(false);
  const [isHovering, setIsHovering] = useState(false);
  const containerRef = useRef<HTMLDivElement>(null);
  const titleRef = useRef<HTMLDivElement>(null);
  const [duplicatedTitle, setDuplicatedTitle] = useState(
    `${title}     ${title}`
  );
  const [animationDuration, setAnimationDuration] = useState(0);

  useEffect(() => {
    if (titleRef.current && containerRef.current) {
      const isTextOverflowing =
        titleRef.current.scrollWidth > containerRef.current.clientWidth;
      setIsOverflowing(isTextOverflowing);

      if (isTextOverflowing) {
        setDuplicatedTitle(`${title}     ${title}`);

        const baseSpeed = 5;
        const standardLength = 30;
        const speedFactor = Math.max(1, title.length / standardLength);
        setAnimationDuration(baseSpeed * speedFactor);
      } else {
        setDuplicatedTitle(title);
      }
    }
  }, [title, containerRef, titleRef]);

  return (
    <div
      ref={containerRef}
      className="relative overflow-hidden"
      onMouseEnter={() => setIsHovering(true)}
      onMouseLeave={() => setIsHovering(false)}
    >
      <div
        ref={titleRef}
        className={`font-medium text-white text-xl whitespace-nowrap ${
          isOverflowing && isHovering ? "animate-marquee" : ""
        }`}
        style={{
          animation:
            isOverflowing && isHovering
              ? `marquee ${animationDuration}s linear infinite`
              : "none",
          transform: !isHovering ? "translateX(0)" : undefined,
        }}
      >
        {isOverflowing ? duplicatedTitle : title}
      </div>
    </div>
  );
}
